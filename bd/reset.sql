DROP TABLE IF EXISTS adrianpedro2122.GRUPOS;
DROP TABLE IF EXISTS adrianpedro2122.LISTAPRODUCTOS;
DROP TABLE IF EXISTS adrianpedro2122.LISTA;
DROP TABLE IF EXISTS adrianpedro2122.USUARIOS;
DROP TABLE IF EXISTS adrianpedro2122.PRODUCTOS;
DROP TABLE IF EXISTS adrianpedro2122.LOG;
DROP TABLE IF EXISTS adrianpedro2122.HISTORICO;
DROP TABLE IF EXISTS adrianpedro2122.HISTORICOPRODUCTOS;


CREATE TABLE adrianpedro2122.USUARIOS (
  IDUSUARIO INT NOT NULL AUTO_INCREMENT,
  DNI VARCHAR(9) UNIQUE,
  NOMBRE VARCHAR(50),
  APELLIDOS VARCHAR(100),
  TELEFONO VARCHAR(20) UNIQUE,
  EMAIL VARCHAR(200) UNIQUE,
  PASSWORD VARCHAR(45),
  FNAC DATE,
  SEXO ENUM('Masculino','Femenino'),
  ROL ENUM('Administrador','Usuario'),
  ESTADO ENUM('Activo','Inactivo'),
  IMGTYPE ENUM('image/jpeg', 'image/png', 'image/jpg'),
  IMGBINARY LONGBLOB,
  LASTLOGIN DATETIME,

  CONSTRAINT PK_IDUSUARIO PRIMARY KEY(IDUSUARIO)
);

CREATE TABLE adrianpedro2122.LISTA (
  IDLISTA INT NOT NULL AUTO_INCREMENT,
  IDPROPIETARIO INT,
  NOMBRE VARCHAR (45),
  DESCRIPCION VARCHAR(200),
  FECHA DATETIME,
  IMGTYPE ENUM('image/jpeg', 'image/png', 'image/jpg'),
  IMGBINARY LONGBLOB,

  CONSTRAINT PK_IDLISTA PRIMARY KEY(IDLISTA),
  CONSTRAINT FK_IDPROPIETARIO FOREIGN KEY(IDPROPIETARIO) REFERENCES USUARIOS(IDUSUARIO)
);

CREATE TABLE adrianpedro2122.PRODUCTOS (
  IDPRODUCTO INT NOT NULL AUTO_INCREMENT,
  NOMBRE VARCHAR(45),
  DESCRIPCION VARCHAR(45),

  CONSTRAINT PK_IDPRODUCTO PRIMARY KEY(IDPRODUCTO)
);


CREATE TABLE adrianpedro2122.LISTAPRODUCTOS (
  IDLISTA INT,
  IDPRODUCTO INT,
  CANTIDAD INT,

  CONSTRAINT FK_LISTACOMPRA_LISTAID FOREIGN KEY(IDLISTA) REFERENCES LISTA(IDLISTA),
  CONSTRAINT FK_LISTACOMPRA_IDPRODUCTO FOREIGN KEY(IDPRODUCTO) REFERENCES PRODUCTOS(IDPRODUCTO)
);

CREATE TABLE adrianpedro2122.GRUPOS (
  IDLISTA INT,
  IDUSUARIO INT,
  PRIVILEGIOS ENUM('Propietario','Editor','Lector'),

  CONSTRAINT FK_GRUPOS_LISTAID FOREIGN KEY(IDLISTA) REFERENCES LISTA(IDLISTA),
  CONSTRAINT FK_GRUPOS_IDUSUARIO FOREIGN KEY(IDUSUARIO) REFERENCES USUARIOS(IDUSUARIO)
);


/*Tablas de log*/
CREATE TABLE adrianpedro2122.LOG(
  IDLOG INT NOT NULL AUTO_INCREMENT,
  FECHA DATETIME,
  DESCRIPCION VARCHAR(200),

  CONSTRAINT PK_IDLOG PRIMARY KEY(IDLOG)
);


CREATE TABLE adrianpedro2122.HISTORICO (
  IDHISTORICO INT NOT NULL AUTO_INCREMENT,
  NOMBRE VARCHAR(200),
  CANTIDAD INT,

  CONSTRAINT PK_IDHISTORICO PRIMARY KEY(IDHISTORICO)
);

-- Tabla de productos comprados en historico

CREATE TABLE adrianpedro2122.HISTORICOPRODUCTOS (
  IDHISTORICO INT NOT NULL AUTO_INCREMENT,
  NOMBRE VARCHAR(200),
  CANTIDAD INT,

  CONSTRAINT PK_IDHISTORICO PRIMARY KEY(IDHISTORICO)
);

DROP TRIGGER IF EXISTS LOGIN_USER;
DROP TRIGGER IF EXISTS NEW_LISTA;
DROP TRIGGER IF EXISTS DEL_LISTA;
DROP TRIGGER IF EXISTS LISTA_CON_PRODUCTOS;
DROP TRIGGER IF EXISTS PRODUCTO_COMPRADO;
DROP TRIGGER IF EXISTS NEW_USER;
DROP TRIGGER IF EXISTS UPDATE_USER;
DROP TRIGGER IF EXISTS DEL_USER;
